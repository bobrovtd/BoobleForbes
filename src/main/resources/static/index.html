<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FormBuilder - Аналог Google Forms</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-100">
<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect } = React;

    // Компонент для главной страницы "Мои формы"
    const MyForms = ({ setCurrentPage, forms, setForms }) => {
        const [newFormTitle, setNewFormTitle] = useState('');

        const handleCreateForm = async () => {
            if (newFormTitle.trim() === '') return;

            try {
                const res = await fetch('/api/forms', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title: newFormTitle.trim(),
                        description: '',
                        questions: []
                    })
                });

                if (!res.ok) {
                    throw new Error('Не удалось создать форму');
                }

                const created = await res.json();
                setForms(prev => [...prev, created]);
                setNewFormTitle('');
            } catch (e) {
                console.error(e);
                alert('Ошибка при создании формы');
            }
        };

        const handleDeleteForm = async (id) => {
            try {
                const res = await fetch(`/api/forms/${id}`, {
                    method: 'DELETE'
                });

                if (!res.ok && res.status !== 204) {
                    throw new Error('Не удалось удалить форму');
                }

                setForms(prev => prev.filter(form => form.id !== id));
            } catch (e) {
                console.error(e);
                alert('Ошибка при удалении формы');
            }
        };

        return (
            <div className="p-6 max-w-6xl mx-auto">
                <div className="flex justify-between items-center mb-8">
                    <h1 className="text-3xl font-bold text-gray-800">Мои формы</h1>
                    <button
                        onClick={() => setCurrentPage('editor')}
                        className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center"
                    >
                        <i className="fas fa-plus mr-2"></i> Создать форму
                    </button>
                </div>

                <div className="mb-6 bg-white p-4 rounded-lg shadow">
                    <div className="flex">
                        <input
                            type="text"
                            value={newFormTitle}
                            onChange={(e) => setNewFormTitle(e.target.value)}
                            placeholder="Название новой формы"
                            className="flex-1 border border-gray-300 rounded-l-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                        <button
                            onClick={handleCreateForm}
                            className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-r-lg"
                        >
                            Создать
                        </button>
                    </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {forms.map(form => (
                        <div key={form.id} className="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
                            <div className="p-5">
                                <h3 className="font-semibold text-lg mb-2 text-gray-800">{form.title}</h3>
                                <p className="text-gray-600 text-sm mb-4">{form.description || 'Нет описания'}</p>
                                <div className="flex justify-between text-sm text-gray-500 mb-4">
                                    <span>{form.questions.length} вопросов</span>
                                    <span>{(form.responses || []).length} ответов</span>
                                </div>
                                <div className="flex space-x-2">
                                    <button
                                        onClick={() => setCurrentPage({ name: 'editor', formId: form.id })}
                                        className="flex-1 bg-blue-100 hover:bg-blue-200 text-blue-700 py-2 rounded text-sm"
                                    >
                                        Редактировать
                                    </button>
                                    <button
                                        onClick={() => setCurrentPage({ name: 'preview', formId: form.id })}
                                        className="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 rounded text-sm"
                                    >
                                        Предпросмотр
                                    </button>
                                    <button
                                        onClick={() => setCurrentPage({ name: 'results', formId: form.id })}
                                        className="flex-1 bg-purple-100 hover:bg-purple-200 text-purple-700 py-2 rounded text-sm"
                                    >
                                        Результаты
                                    </button>
                                    <button
                                        onClick={() => handleDeleteForm(form.id)}
                                        className="bg-red-100 hover:bg-red-200 text-red-700 py-2 px-3 rounded text-sm"
                                    >
                                        <i className="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    ))}
                </div>

                {forms.length === 0 && (
                    <div className="text-center py-12">
                        <i className="fas fa-file-alt text-gray-400 text-6xl mb-4"></i>
                        <h3 className="text-xl font-medium text-gray-600 mb-2">Формы отсутствуют</h3>
                        <p className="text-gray-500 mb-4">Создайте свою первую форму, чтобы начать сбор данных</p>
                        <button
                            onClick={() => setCurrentPage('editor')}
                            className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg"
                        >
                            Создать первую форму
                        </button>
                    </div>
                )}
            </div>
        );
    };

    // Компонент редактора формы
    const FormEditor = ({ setCurrentPage, forms, setForms, currentFormId }) => {
        const [form, setForm] = useState({
            title: '',
            description: '',
            questions: []
        });
        const [currentQuestion, setCurrentQuestion] = useState({
            type: 'text',
            question: '',
            required: false,
            options: ['']
        });

        useEffect(() => {
            if (currentFormId) {
                const existingForm = forms.find(f => f.id === currentFormId);
                if (existingForm) {
                    setForm(existingForm);
                }
            }
        }, [currentFormId, forms]);

        const handleSaveForm = async () => {
            if (!form.title.trim()) {
                alert('Введите название формы');
                return;
            }

            const payload = {
                title: form.title,
                description: form.description,
                questions: form.questions
            };

            try {
                if (currentFormId) {
                    const res = await fetch(`/api/forms/${currentFormId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!res.ok) {
                        throw new Error('Не удалось обновить форму');
                    }

                    const updated = await res.json();
                    setForms(prev => prev.map(f => f.id === currentFormId ? updated : f));
                } else {
                    const res = await fetch('/api/forms', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!res.ok) {
                        throw new Error('Не удалось создать форму');
                    }

                    const created = await res.json();
                    setForms(prev => [...prev, created]);
                }

                setCurrentPage('myForms');
            } catch (e) {
                console.error(e);
                alert('Ошибка при сохранении формы');
            }
        };

        const addQuestion = () => {
            if (!currentQuestion.question.trim()) return;

            const newQuestion = {
                ...currentQuestion,
                id: Date.now()
            };

            setForm({
                ...form,
                questions: [...form.questions, newQuestion]
            });

            setCurrentQuestion({
                type: 'text',
                question: '',
                required: false,
                options: ['']
            });
        };

        const updateQuestion = (index, field, value) => {
            const updatedQuestions = [...form.questions];
            updatedQuestions[index][field] = value;
            setForm({ ...form, questions: updatedQuestions });
        };

        const deleteQuestion = (index) => {
            const updatedQuestions = form.questions.filter((_, i) => i !== index);
            setForm({ ...form, questions: updatedQuestions });
        };

        const addOption = (questionIndex) => {
            const updatedQuestions = [...form.questions];
            updatedQuestions[questionIndex].options = [...updatedQuestions[questionIndex].options, ''];
            setForm({ ...form, questions: updatedQuestions });
        };

        const updateOption = (questionIndex, optionIndex, value) => {
            const updatedQuestions = [...form.questions];
            updatedQuestions[questionIndex].options[optionIndex] = value;
            setForm({ ...form, questions: updatedQuestions });
        };

        const deleteOption = (questionIndex, optionIndex) => {
            const updatedQuestions = [...form.questions];
            updatedQuestions[questionIndex].options = updatedQuestions[questionIndex].options.filter((_, i) => i !== optionIndex);
            setForm({ ...form, questions: updatedQuestions });
        };

        return (
            <div className="p-6 max-w-4xl mx-auto">
                <div className="flex justify-between items-center mb-6">
                    <h1 className="text-3xl font-bold text-gray-800">Редактор формы</h1>
                    <div className="flex space-x-2">
                        <button
                            onClick={() => setCurrentPage('myForms')}
                            className="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg"
                        >
                            Отмена
                        </button>
                        <button
                            onClick={handleSaveForm}
                            className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg"
                        >
                            Сохранить
                        </button>
                    </div>
                </div>

                <div className="bg-white p-6 rounded-lg shadow mb-6">
                    <div className="mb-4">
                        <label className="block text-gray-700 mb-2">Название формы</label>
                        <input
                            type="text"
                            value={form.title}
                            onChange={(e) => setForm({...form, title: e.target.value})}
                            className="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="Введите название формы"
                        />
                    </div>
                    <div>
                        <label className="block text-gray-700 mb-2">Описание (необязательно)</label>
                        <textarea
                            value={form.description}
                            onChange={(e) => setForm({...form, description: e.target.value})}
                            className="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="Введите описание формы"
                            rows="3"
                        />
                    </div>
                </div>

                <div className="bg-white p-6 rounded-lg shadow">
                    <h2 className="text-xl font-semibold mb-4">Добавить вопрос</h2>
                    <div className="mb-4">
                        <label className="block text-gray-700 mb-2">Тип вопроса</label>
                        <select
                            value={currentQuestion.type}
                            onChange={(e) => setCurrentQuestion({...currentQuestion, type: e.target.value})}
                            className="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        >
                            <option value="text">Короткий ответ</option>
                            <option value="textarea">Длинный ответ</option>
                            <option value="radio">Один выбор</option>
                            <option value="checkbox">Несколько вариантов</option>
                            <option value="dropdown">Выпадающий список</option>
                        </select>
                    </div>
                    <div className="mb-4">
                        <label className="block text-gray-700 mb-2">Вопрос</label>
                        <input
                            type="text"
                            value={currentQuestion.question}
                            onChange={(e) => setCurrentQuestion({...currentQuestion, question: e.target.value})}
                            className="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="Введите вопрос"
                        />
                    </div>
                    <div className="mb-4">
                        <label className="flex items-center">
                            <input
                                type="checkbox"
                                checked={currentQuestion.required}
                                onChange={(e) => setCurrentQuestion({...currentQuestion, required: e.target.checked})}
                                className="mr-2"
                            />
                            Обязательный вопрос
                        </label>
                    </div>
                    {(currentQuestion.type === 'radio' || currentQuestion.type === 'checkbox' || currentQuestion.type === 'dropdown') && (
                        <div className="mb-4">
                            <label className="block text-gray-700 mb-2">Варианты ответа</label>
                            {currentQuestion.options.map((option, index) => (
                                <div key={index} className="flex items-center mb-2">
                                    <input
                                        type="text"
                                        value={option}
                                        onChange={(e) => {
                                            const newOptions = [...currentQuestion.options];
                                            newOptions[index] = e.target.value;
                                            setCurrentQuestion({...currentQuestion, options: newOptions});
                                        }}
                                        className="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        placeholder="Введите вариант"
                                    />
                                    {currentQuestion.options.length > 1 && (
                                        <button
                                            onClick={() => {
                                                const newOptions = currentQuestion.options.filter((_, i) => i !== index);
                                                setCurrentQuestion({...currentQuestion, options: newOptions});
                                            }}
                                            className="ml-2 bg-red-100 hover:bg-red-200 text-red-700 px-3 py-2 rounded"
                                        >
                                            <i className="fas fa-trash"></i>
                                        </button>
                                    )}
                                </div>
                            ))}
                            <button
                                onClick={() => setCurrentQuestion({...currentQuestion, options: [...currentQuestion.options, '']})}
                                className="text-blue-600 hover:text-blue-800 flex items-center"
                            >
                                <i className="fas fa-plus mr-1"></i> Добавить вариант
                            </button>
                        </div>
                    )}
                    <button
                        onClick={addQuestion}
                        className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg"
                    >
                        Добавить вопрос
                    </button>
                </div>

                {form.questions.length > 0 && (
                    <div className="mt-6 bg-white p-6 rounded-lg shadow">
                        <h2 className="text-xl font-semibold mb-4">Вопросы формы</h2>
                        {form.questions.map((question, index) => (
                            <div key={question.id} className="border border-gray-200 rounded-lg p-4 mb-4">
                                <div className="flex justify-between items-start mb-2">
                                    <h3 className="font-medium">{index + 1}. {question.question} {question.required && <span className="text-red-500">*</span>}</h3>
                                    <button
                                        onClick={() => deleteQuestion(index)}
                                        className="text-red-500 hover:text-red-700"
                                    >
                                        <i className="fas fa-trash"></i>
                                    </button>
                                </div>
                                <div className="text-sm text-gray-600 mb-2">
                                    Тип: {question.type === 'text' && 'Короткий ответ'}
                                    {question.type === 'textarea' && 'Длинный ответ'}
                                    {question.type === 'radio' && 'Один выбор'}
                                    {question.type === 'checkbox' && 'Несколько вариантов'}
                                    {question.type === 'dropdown' && 'Выпадающий список'}
                                </div>
                                {(question.type === 'radio' || question.type === 'checkbox' || question.type === 'dropdown') && (
                                    <div className="ml-4">
                                        {question.options.map((option, optIndex) => (
                                            <div key={optIndex} className="flex items-center mb-1">
                                                {question.type === 'radio' && <i className="far fa-circle mr-2 text-gray-400"></i>}
                                                {question.type === 'checkbox' && <i className="far fa-square mr-2 text-gray-400"></i>}
                                                {question.type === 'dropdown' && <i className="fas fa-caret-down mr-2 text-gray-400"></i>}
                                                <input
                                                    type="text"
                                                    value={option}
                                                    onChange={(e) => updateOption(index, optIndex, e.target.value)}
                                                    className="border border-gray-300 rounded px-2 py-1 text-sm w-full"
                                                />
                                                <button
                                                    onClick={() => deleteOption(index, optIndex)}
                                                    className="ml-2 text-red-500 hover:text-red-700 text-sm"
                                                >
                                                    <i className="fas fa-times"></i>
                                                </button>
                                            </div>
                                        ))}
                                        <button
                                            onClick={() => addOption(index)}
                                            className="text-blue-600 hover:text-blue-800 text-sm flex items-center mt-2"
                                        >
                                            <i className="fas fa-plus mr-1"></i> Добавить вариант
                                        </button>
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                )}
            </div>
        );
    };

    // Компонент предпросмотра формы
    const PreviewForm = ({ setCurrentPage, forms, currentFormId }) => {
        const form = forms.find(f => f.id === currentFormId);

        if (!form) {
            return (
                <div className="p-6 max-w-2xl mx-auto text-center">
                    <h1 className="text-2xl font-bold text-gray-800 mb-4">Форма не найдена</h1>
                    <button
                        onClick={() => setCurrentPage('myForms')}
                        className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg"
                    >
                        Вернуться к формам
                    </button>
                </div>
            );
        }

        return (
            <div className="p-6 max-w-2xl mx-auto">
                <div className="flex justify-between items-center mb-6">
                    <h1 className="text-3xl font-bold text-gray-800">Предпросмотр формы</h1>
                    <button
                        onClick={() => setCurrentPage('myForms')}
                        className="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg"
                    >
                        Назад
                    </button>
                </div>

                <div className="bg-white p-8 rounded-lg shadow">
                    <h2 className="text-2xl font-bold mb-2">{form.title}</h2>
                    {form.description && <p className="text-gray-600 mb-6">{form.description}</p>}

                    {form.questions.length === 0 ? (
                        <div className="text-center py-12">
                            <i className="fas fa-file-alt text-gray-400 text-4xl mb-4"></i>
                            <p className="text-gray-600">В этой форме пока нет вопросов</p>
                        </div>
                    ) : (
                        <div className="space-y-6">
                            {form.questions.map((question, index) => (
                                <div key={index} className="mb-6">
                                    <div className="flex items-start">
                                        <span className="font-medium mr-2">{index + 1}.</span>
                                        <div>
                                            <label className="block font-medium mb-2">
                                                {question.question} {question.required && <span className="text-red-500">*</span>}
                                            </label>
                                            {question.type === 'text' && (
                                                <input
                                                    type="text"
                                                    className="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                    placeholder="Введите ответ"
                                                    disabled
                                                />
                                            )}
                                            {question.type === 'textarea' && (
                                                <textarea
                                                    className="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                    placeholder="Введите ответ"
                                                    rows="4"
                                                    disabled
                                                ></textarea>
                                            )}
                                            {question.type === 'radio' && (
                                                <div className="space-y-2">
                                                    {question.options.map((option, optIndex) => (
                                                        <div key={optIndex} className="flex items-center">
                                                            <input
                                                                type="radio"
                                                                name={`question-${index}`}
                                                                className="mr-2"
                                                                disabled
                                                            />
                                                            <span>{option}</span>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                            {question.type === 'checkbox' && (
                                                <div className="space-y-2">
                                                    {question.options.map((option, optIndex) => (
                                                        <div key={optIndex} className="flex items-center">
                                                            <input
                                                                type="checkbox"
                                                                className="mr-2"
                                                                disabled
                                                            />
                                                            <span>{option}</span>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                            {question.type === 'dropdown' && (
                                                <select
                                                    className="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                    disabled
                                                >
                                                    <option value="">Выберите вариант</option>
                                                    {question.options.map((option, optIndex) => (
                                                        <option key={optIndex} value={option}>{option}</option>
                                                    ))}
                                                </select>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            </div>
        );
    };

    // Компонент заполнения формы
    const FillForm = ({ setCurrentPage, forms, currentFormId, setForms }) => {
        const [form] = useState(forms.find(f => f.id === currentFormId));
        const [answers, setAnswers] = useState({});
        const [isSubmitted, setIsSubmitted] = useState(false);

        if (!form) {
            return (
                <div className="p-6 max-w-2xl mx-auto text-center">
                    <h1 className="text-2xl font-bold text-gray-800 mb-4">Форма не найдена</h1>
                    <button
                        onClick={() => setCurrentPage('myForms')}
                        className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg"
                    >
                        Вернуться к формам
                    </button>
                </div>
            );
        }

        const handleAnswerChange = (questionIndex, value, isMultiple = false) => {
            setAnswers(prev => {
                const newAnswers = { ...prev };

                if (isMultiple) {
                    const currentAnswers = newAnswers[questionIndex] || [];
                    if (currentAnswers.includes(value)) {
                        newAnswers[questionIndex] = currentAnswers.filter(v => v !== value);
                    } else {
                        newAnswers[questionIndex] = [...currentAnswers, value];
                    }
                } else {
                    newAnswers[questionIndex] = value;
                }

                return newAnswers;
            });
        };

        const handleSubmit = async (e) => {
            e.preventDefault();

            // Проверка обязательных полей
            const requiredQuestions = form.questions.filter(q => q.required);
            for (const question of requiredQuestions) {
                const idx = form.questions.indexOf(question);
                const answer = answers[idx];
                if (!answer || (Array.isArray(answer) && answer.length === 0)) {
                    alert(`Пожалуйста, ответьте на обязательный вопрос: ${question.question}`);
                    return;
                }
            }

            // Подготовка ответов для бэка (строки)
            const answersToSend = {};
            form.questions.forEach((q, index) => {
                const ans = answers[index];
                if (Array.isArray(ans)) {
                    answersToSend[index] = ans.join(', ');
                } else {
                    answersToSend[index] = ans || '';
                }
            });

            try {
                const res = await fetch(`/api/forms/${currentFormId}/responses`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ answers: answersToSend })
                });

                if (!res.ok) {
                    throw new Error('Не удалось отправить ответ');
                }

                // обновляем форму в стейте из бэка, чтобы результаты были актуальны
                const formRes = await fetch(`/api/forms/${currentFormId}`);
                if (formRes.ok) {
                    const updatedForm = await formRes.json();
                    setForms(prev => prev.map(f => f.id === currentFormId ? updatedForm : f));
                }

                setIsSubmitted(true);
            } catch (e) {
                console.error(e);
                alert('Ошибка при отправке ответа');
            }
        };

        if (isSubmitted) {
            return (
                <div className="p-6 max-w-2xl mx-auto">
                    <div className="bg-white p-8 rounded-lg shadow text-center">
                        <i className="fas fa-check-circle text-green-500 text-6xl mb-4"></i>
                        <h2 className="text-2xl font-bold mb-2">Спасибо за ответ!</h2>
                        <p className="text-gray-600 mb-6">Ваш ответ успешно отправлен.</p>
                        <button
                            onClick={() => setCurrentPage('myForms')}
                            className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg"
                        >
                            Вернуться к формам
                        </button>
                    </div>
                </div>
            );
        }

        return (
            <div className="p-6 max-w-2xl mx-auto">
                <div className="flex justify-between items-center mb-6">
                    <h1 className="text-3xl font-bold text-gray-800">Заполнить форму</h1>
                    <button
                        onClick={() => setCurrentPage('myForms')}
                        className="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg"
                    >
                        Назад
                    </button>
                </div>

                <div className="bg-white p-8 rounded-lg shadow">
                    <h2 className="text-2xl font-bold mb-2">{form.title}</h2>
                    {form.description && <p className="text-gray-600 mb-6">{form.description}</p>}

                    <form onSubmit={handleSubmit}>
                        <div className="space-y-6">
                            {form.questions.map((question, index) => (
                                <div key={index} className="mb-6">
                                    <div className="flex items-start">
                                        <span className="font-medium mr-2">{index + 1}.</span>
                                        <div className="w-full">
                                            <label className="block font-medium mb-2">
                                                {question.question} {question.required && <span className="text-red-500">*</span>}
                                            </label>
                                            {question.type === 'text' && (
                                                <input
                                                    type="text"
                                                    className="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                    placeholder="Введите ответ"
                                                    value={answers[index] || ''}
                                                    onChange={(e) => handleAnswerChange(index, e.target.value)}
                                                />
                                            )}
                                            {question.type === 'textarea' && (
                                                <textarea
                                                    className="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                    placeholder="Введите ответ"
                                                    rows="4"
                                                    value={answers[index] || ''}
                                                    onChange={(e) => handleAnswerChange(index, e.target.value)}
                                                ></textarea>
                                            )}
                                            {question.type === 'radio' && (
                                                <div className="space-y-2">
                                                    {question.options.map((option, optIndex) => (
                                                        <div key={optIndex} className="flex items-center">
                                                            <input
                                                                type="radio"
                                                                name={`question-${index}`}
                                                                className="mr-2"
                                                                checked={answers[index] === option}
                                                                onChange={() => handleAnswerChange(index, option)}
                                                            />
                                                            <span>{option}</span>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                            {question.type === 'checkbox' && (
                                                <div className="space-y-2">
                                                    {question.options.map((option, optIndex) => (
                                                        <div key={optIndex} className="flex items-center">
                                                            <input
                                                                type="checkbox"
                                                                className="mr-2"
                                                                checked={answers[index] && answers[index].includes(option)}
                                                                onChange={() => handleAnswerChange(index, option, true)}
                                                            />
                                                            <span>{option}</span>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                            {question.type === 'dropdown' && (
                                                <select
                                                    className="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                    value={answers[index] || ''}
                                                    onChange={(e) => handleAnswerChange(index, e.target.value)}
                                                >
                                                    <option value="">Выберите вариант</option>
                                                    {question.options.map((option, optIndex) => (
                                                        <option key={optIndex} value={option}>{option}</option>
                                                    ))}
                                                </select>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>

                        <div className="mt-8">
                            <button
                                type="submit"
                                className="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-medium"
                            >
                                Отправить
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        );
    };

    // Компонент результатов формы
    const FormResults = ({ setCurrentPage, forms, currentFormId }) => {
        const form = forms.find(f => f.id === currentFormId);

        if (!form) {
            return (
                <div className="p-6 max-w-4xl mx-auto text-center">
                    <h1 className="text-2xl font-bold text-gray-800 mb-4">Форма не найдена</h1>
                    <button
                        onClick={() => setCurrentPage('myForms')}
                        className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg"
                    >
                        Вернуться к формам
                    </button>
                </div>
            );
        }

        const responses = form.responses || [];

        return (
            <div className="p-6 max-w-6xl mx-auto">
                <div className="flex justify-between items-center mb-6">
                    <h1 className="text-3xl font-bold text-gray-800">Результаты формы</h1>
                    <div className="flex space-x-2">
                        <button
                            onClick={() => setCurrentPage('myForms')}
                            className="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg"
                        >
                            Назад
                        </button>
                        <button
                            onClick={() => setCurrentPage({ name: 'fill', formId: form.id })}
                            className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg"
                        >
                            Пройти форму
                        </button>
                    </div>
                </div>

                <div className="bg-white p-6 rounded-lg shadow mb-6">
                    <h2 className="text-2xl font-bold mb-2">{form.title}</h2>
                    <p className="text-gray-600 mb-4">{form.description || 'Нет описания'}</p>
                    <div className="flex space-x-6 text-sm text-gray-600">
                        <span><i className="fas fa-question-circle mr-1"></i> {form.questions.length} вопросов</span>
                        <span><i className="fas fa-user mr-1"></i> {responses.length} ответов</span>
                    </div>
                </div>

                {responses.length === 0 ? (
                    <div className="bg-white p-12 rounded-lg shadow text-center">
                        <i className="fas fa-chart-bar text-gray-400 text-6xl mb-4"></i>
                        <h3 className="text-xl font-medium text-gray-600 mb-2">Пока нет ответов</h3>
                        <p className="text-gray-500 mb-4">Когда люди начнут заполнять форму, ответы появятся здесь</p>
                        <button
                            onClick={() => setCurrentPage({ name: 'fill', formId: form.id })}
                            className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg"
                        >
                            Пройти форму
                        </button>
                    </div>
                ) : (
                    <div className="bg-white rounded-lg shadow overflow-hidden">
                        <div className="overflow-x-auto">
                            <table className="min-w-full divide-y divide-gray-200">
                                <thead className="bg-gray-50">
                                    <tr>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ответ</th>
                                        {form.questions.map((question, index) => (
                                            <th key={index} className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                {question.question}
                                            </th>
                                        ))}
                                    </tr>
                                </thead>
                                <tbody className="bg-white divide-y divide-gray-200">
                                    {responses.map((response, responseIndex) => (
                                        <tr key={response.id || responseIndex} className={responseIndex % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                #{responseIndex + 1}
                                            </td>
                                            {form.questions.map((question, questionIndex) => {
                                                const answer = response.answers ? response.answers[questionIndex] : null;
                                                return (
                                                    <td key={questionIndex} className="px-6 py-4 text-sm text-gray-800">
                                                        {Array.isArray(answer)
                                                            ? answer.join(', ')
                                                            : answer || 'Не отвечено'
                                                        }
                                                    </td>
                                                );
                                            })}
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                )}
            </div>
        );
    };

    // Главный компонент приложения
    const App = () => {
        const [currentPage, setCurrentPage] = useState('myForms');
        const [forms, setForms] = useState([]);

        useEffect(() => {
            const fetchForms = async () => {
                try {
                    const res = await fetch('/api/forms');
                    if (!res.ok) {
                        throw new Error('Не удалось загрузить формы');
                    }
                    const data = await res.json();
                    setForms(data);
                } catch (e) {
                    console.error(e);
                    // можно показать alert, но чтобы не раздражать — просто в консоль
                }
            };

            fetchForms();
        }, []);

        const renderCurrentPage = () => {
            if (typeof currentPage === 'object') {
                switch (currentPage.name) {
                    case 'editor':
                        return <FormEditor
                            setCurrentPage={setCurrentPage}
                            forms={forms}
                            setForms={setForms}
                            currentFormId={currentPage.formId}
                        />;
                    case 'preview':
                        return <PreviewForm
                            setCurrentPage={setCurrentPage}
                            forms={forms}
                            currentFormId={currentPage.formId}
                        />;
                    case 'results':
                        return <FormResults
                            setCurrentPage={setCurrentPage}
                            forms={forms}
                            currentFormId={currentPage.formId}
                        />;
                    case 'fill':
                        return <FillForm
                            setCurrentPage={setCurrentPage}
                            forms={forms}
                            currentFormId={currentPage.formId}
                            setForms={setForms}
                        />;
                    default:
                        return <MyForms setCurrentPage={setCurrentPage} forms={forms} setForms={setForms} />;
                }
            }

            switch (currentPage) {
                case 'myForms':
                    return <MyForms setCurrentPage={setCurrentPage} forms={forms} setForms={setForms} />;
                case 'editor':
                    return <FormEditor
                        setCurrentPage={setCurrentPage}
                        forms={forms}
                        setForms={setForms}
                        currentFormId={null}
                    />;
                default:
                    return <MyForms setCurrentPage={setCurrentPage} forms={forms} setForms={setForms} />;
            }
        };

        return (
            <div className="min-h-screen bg-gray-100">
                <header className="bg-white shadow">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="flex justify-between h-16">
                            <div className="flex items-center">
                                <i className="fas fa-file-alt text-blue-600 text-2xl mr-3"></i>
                                <h1 className="text-xl font-bold text-gray-900">FormBuilder</h1>
                            </div>
                            <nav className="flex space-x-4">
                                <button
                                    onClick={() => setCurrentPage('myForms')}
                                    className={`px-3 py-2 rounded-md text-sm font-medium ${
                                        currentPage === 'myForms' ? 'bg-blue-100 text-blue-700' : 'text-gray-700 hover:bg-gray-100'
                                    }`}
                                >
                                    Мои формы
                                </button>
                            </nav>
                        </div>
                    </div>
                </header>

                <main>
                    {renderCurrentPage()}
                </main>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>
